
  <div class="container py-4 bg-light min-vh-100">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1>Welcome, {{username}}</h1>
      </div>
      <button class="btn btn-outline-dark" (click)="logout()">Logout</button>
    </div>
    <!-- Statistics for user -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="h5 fw-semibold">Current Stats:</h2> <hr>
        <h2 class="h5 fw-semibold">Average Rating: {{ avgRating | number:'1.1-2' }}</h2>
        <h2 class="h5 fw-semibold">Total Pages Read: {{ totalPagesRead }}</h2>
        <button (click)="toggleBookForm()" class="btn btn-outline-secondary">
          Add Book
        </button>
        <button (click)="generateReport()" class="btn btn-outline-primary mx-2">Generate Report</button>
        <div *ngIf="message" class="alert alert-info mt-2">
          {{ message }}
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search" 
          [(ngModel)]="search"
          (keyup.enter)="searchBooks()"
          (input)="searchBooks()"
      />

      <select class="form-select w-auto" [(ngModel)]="searchBy">
        <option value="title">Title</option>
        <option value="author">Author</option>
        <option value="rating">Rating</option>
      </select>

      <button class="btn btn-primary" (click)="searchBooks()">
        Search
      </button>

      <button class="btn btn-secondary" (click)="resetSearch()">
        Reset
      </button>

      <select class="form-select w-auto ms-3" [(ngModel)]="sortBy" (change)="sortBooks()">
        <option value="">Sort By</option>
        <option value="rating">Highest Rating</option>
        <option value="pagesRead">Most Pages Read</option>
      </select>

      </div>
    </div>
  
    <!-- Add Book -->
    <div *ngIf="bookFormVisible" class="card mb-4">
      <div class="card-body">
        <form [formGroup]="newBookForm" (ngSubmit)="addBook()">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="title" class="form-label">Title</label>
              <input id="title" formControlName="title" placeholder="Enter title" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="author" class="form-label">Author</label>
              <input id="author" formControlName="author" placeholder="Enter author" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="yearPublished" class="form-label">Year Published</label>
              <input id="yearPublished" formControlName="yearPublished" placeholder="Enter year published" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="pageCount" class="form-label">Page Count</label>
              <input id="pageCount" type="number" formControlName="pageCount" placeholder="Enter total pages" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="status" class="form-label">Status</label>
              <select id="status" formControlName="status" class="form-select" required>
                <option *ngFor="let status of bookStatusOptions" [value]="status">
                  {{ status }}
                </option>
              </select>
            </div>
            <div class="col-md-6" *ngIf="newBookForm.get('status')?.value === 'HAVE_READ'">
              <label for="rating" class="form-label">Rating</label>
              <select id="rating" formControlName="rating" class="form-select">
                <option *ngFor="let r of [1,2,3,4,5]" [value]="r">{{ r }}</option>
              </select>
            </div>
          </div>
  
          <div class="d-flex justify-content-end gap-2 mt-3">
            <button 
              type="button" 
              (click)="toggleBookForm()" 
              class="btn btn-outline-secondary">
              Cancel
            </button>
            <button type="submit" class="btn btn-dark">
              Save
            </button>
          </div>
        </form>
      </div>
    </div>
  
    <!-- Book Cards -->
    <div class="row g-4">
      <div *ngFor="let book of filteredBooks" class="col-12 col-sm-6 col-lg-4">
        <div class="card h-100 d-flex flex-column justify-content-between text-center">
          <div class="card-body d-flex flex-column justify-content-center align-items-center">
            <div class="mb-3">
              <h3 class="card-title h5">{{ book.title }}</h3>
              <p class="card-text text-muted">{{ book.author }} ({{ book.yearPublished }})</p>
              <p class="mb-1">Pages: {{ book.pagesRead }}/{{ book.pageCount }}</p>
              <p class="mb-1">Status: <strong>{{ book.status }}</strong></p>
              <p class="mb-3">Rating: {{ book.rating ?? 'N/A' }}</p>
            </div>
            <div class="w-100 border-top pt-3">
              <div class="mb-2 text-start">
                <label for="pagesRead-{{book.bookId}}" class="form-label">Pages Read</label>
                <input
                  id="pagesRead-{{book.bookId}}"
                  type="number"
                  [(ngModel)]="book.pagesRead"
                  [max]="book.pageCount"
                  placeholder="Pages Read"
                  class="form-control"
                />
              </div>
              <div class="mb-2 text-start">
                <label for="status-{{book.bookId}}" class="form-label">Status</label>
                <select id="status-{{book.bookId}}" [(ngModel)]="book.status" class="form-select">
                  <option *ngFor="let status of bookStatusOptions" [value]="status">
                    {{ status }}
                  </option>
                </select>
              </div>
              <div class="mb-2 text-start" *ngIf="book.status === 'HAVE_READ'">
                <label for="rating-{{book.bookId}}" class="form-label">Rating</label>
                <select
                  id="rating-{{book.bookId}}"
                  [(ngModel)]="book.rating"
                  class="form-select"
                >
                  <option *ngFor="let r of [1,2,3,4,5]" [value]="r">{{ r }}</option>
                </select>
              </div>
  
              <!-- Buttons -->
              <button 
                (click)="updateBook(book)" 
                class="btn btn-dark w-100">
                Update
              </button>
              <button class="btn btn-danger w-100 mt-2" (click)="deleteBook(book)">
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>